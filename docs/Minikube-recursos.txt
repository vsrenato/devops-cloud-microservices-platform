## Recursos avan√ßados do Minikube

Agora que nos familiarizamos com o comando start padr√£o do minikube , vamos nos aprofundar no Minikube para entender alguns de seus recursos mais avan√ßados.

Por padr√£o, o comando minikube start seleciona um software de isolamento de driver, como um hipervisor ou um ambiente de execu√ß√£o de cont√™iner, caso um (VitualBox) ou v√°rios estejam instalados na esta√ß√£o de trabalho host. Al√©m disso, ele baixa os componentes da vers√£o mais recente do Kubernetes. Com o software de driver selecionado, ele provisiona uma √∫nica VM chamada minikube (com perfil de hardware de CPUs = 2, Mem√≥ria = 6 GB, Disco = 20 GB) ou cont√™iner (Docker) para hospedar o cluster Kubernetes all-in-one padr√£o de n√≥ √∫nico. Ap√≥s o provisionamento do n√≥, ele inicializa o plano de controle do Kubernetes (com a ferramenta padr√£o kubeadm) e instala a vers√£o mais recente do ambiente de execu√ß√£o de cont√™iner padr√£o, o Docker, que servir√° como ambiente de execu√ß√£o para os aplicativos em cont√™iner que implantaremos no cluster Kubernetes. O comando minikube start gera um cluster minikube padr√£o com as especifica√ß√µes descritas acima e as armazena para que possamos reiniciar o cluster padr√£o sempre que desejarmos. O objeto que armazena as especifica√ß√µes do nosso cluster √© chamado de perfil .

√Ä medida que o Minikube amadurece, seus recursos e funcionalidades tamb√©m amadurecem. Com a introdu√ß√£o de perfis, o Minikube permite que os usu√°rios criem clusters reutiliz√°veis ‚Äã‚Äãpersonalizados que podem ser gerenciados a partir de um √∫nico cliente de linha de comando.

O comando minikube profile nos permite visualizar o status de todos os nossos clusters em uma sa√≠da em formato de tabela. Supondo que criamos apenas o cluster minikube padr√£o, poder√≠amos listar as propriedades que definem o perfil padr√£o com:

Lista de perfis do minikube

|----------|------------|---------|----------------|------|---------|--------|--------| |
Perfil | Driver de VM | Tempo de execu√ß√£o | IP | Porta | Vers√£o | Status | N√≥s | Ativo |
|----------|------------|---------|----------------|------|---------|---------|--------|
| minikube | virtualbox | docker | 192.168.59.100 | 8443 | v1.28.3 | Em execu√ß√£o | 1 | * |
|----------|------------|---------|----------------|------|---------|---------|--------|

Esta tabela apresenta as colunas associadas √†s propriedades padr√£o, como o nome do perfil: minikube, o driver de isolamento: VirtualBox, o tempo de execu√ß√£o do cont√™iner: Docker, a vers√£o do Kubernetes: v1.28.3 e o status do cluster - em execu√ß√£o ou parado. A tabela tamb√©m exibe o n√∫mero de n√≥s: 1 por padr√£o, o endere√ßo IP privado da VM VirtualBox do plano de controle do cluster minikube e a porta segura que exp√µe o Servidor de API aos componentes, agentes e clientes do plano de controle do cluster: 8443. 

E se, em vez disso, desejarmos criar v√°rios clusters reutiliz√°veis, com outros drivers (Docker ou Podman - ainda experimental no Linux) para isolamento de n√≥s, ou diferentes vers√µes do Kubernetes (v1.27.10 ou v1.28.1), outro runtime (cri-o ou containerd) e possivelmente 2, 3 ou mais n√≥s (se permitido pelos recursos do nosso sistema host)? E se desejarmos personalizar ainda mais o cluster com uma op√ß√£o de rede ou plugin espec√≠fico? O comando minikube start nos permite criar esses perfis personalizados com as flags --profile ou -p . V√°rios drivers de isolamento tamb√©m suportam a cria√ß√£o de VMs de n√≥s ou cont√™ineres de n√≥s de tamanhos personalizados, recursos que n√£o exploraremos neste curso, pois nem todos s√£o muito est√°veis ‚Äã‚Äãno momento da reda√ß√£o deste artigo.

Abaixo est√£o alguns exemplos de comandos de inicializa√ß√£o mais complexos que permitem a cria√ß√£o de clusters personalizados com o Minikube. Eles pressup√µem que o driver desejado (Docker e/ou Podman) tenha sido instalado na esta√ß√£o de trabalho host. N√£o h√° necessidade de baixar o CNI (plugin de rede) ou o tempo de execu√ß√£o do cont√™iner desejado; eles ser√£o configurados e habilitados pelo Minikube em nosso nome:

$  minikube start --kubernetes-version=v1.27.10 \
  --driver=podman --profile minipod

$ minikube start --nodes=2 --kubernetes-version=v1.28.1 \
  --driver=docker --profile doubledocker

$ minikube start --driver=virtualbox --nodes=3 --disk-size=10g \
  --cpus=2 --memory=6g --kubernetes-version=v1.27.12 --cni=calico \
  --container-runtime=cri-o -p multivbox

$ minikube start --driver=docker --cpus=6 --memory=8g \
  --kubernetes-version="1.27.12" -p largedock

$ minikube start --driver=virtualbox -n 3 --container-runtime=containerd \
  --cni=calico -p minibox

Quando v√°rios perfis de cluster estiverem dispon√≠veis (o minikube padr√£o e o minibox personalizado), a tabela de perfis ficar√° assim:

Lista de perfis do minikube

|----------|------------|---------|----------------|------|---------|--------|--------| |
Perfil | Driver de VM | Tempo de execu√ß√£o | IP | Porta | Vers√£o | Status | N√≥s | Ativo |
|----------|------------|---------|----------------|------|---------|---------|--------|
| minibox | virtualbox | crio | 192.168.59.101 | 8443 | v1.25.3 | Em execu√ß√£o | 3 | |
| minikube | virtualbox | docker | 192.168.59.100 | 8443 | v1.25.3 | Em execu√ß√£o | 1 | * |
|----------|------------|---------|----------------|------|---------|---------|--------|--------|

O marcador ativo indica o perfil do cluster de destino da ferramenta de linha de comando minikube, tamb√©m conhecido como seu contexto. O cluster de destino pode ser definido como minibox com o seguinte comando:

$ minikube perfil minibox

O cluster de destino pode ser definido como o minikube padr√£o com um dos seguintes comandos:

$ perfil minikube minikube

$ minikube perfil padr√£o

## Recursos avan√ßados do Minikube

A maioria dos comandos do minikube , como start, stop, node, etc., reconhecem o perfil, o que significa que o usu√°rio precisa especificar explicitamente o cluster de destino do comando, por meio do nome do perfil. O cluster padr√£o do minikube, no entanto, pode ser gerenciado implicitamente sem especificar seu nome de perfil. Parando e reiniciando os dois clusters listados acima, o cluster do minibox (explicitamente) e o cluster padr√£o do minikube (implicitamente):

$ minikube stop -p minibox

$ minikube start -p minibox

$ minikube stop

$ minikube start

Comandos adicionais √∫teis do minikube :

Para exibir a vers√£o da instala√ß√£o atual do Minikube:

$ vers√£o minikube

vers√£o do minikube: v1.32.0
confirma√ß√£o: 8220a6eb95f0a4d75f7f2d7b14cef975f050512d

A conclus√£o √© uma configura√ß√£o p√≥s-instala√ß√£o √∫til para permitir que o comando minikube responda aos mecanismos t√≠picos de conclus√£o autom√°tica, como concluir um comando no terminal pressionando a tecla TAB. Para habilitar a conclus√£o para o shell bash no Ubuntu:

$ sudo apt install bash-completion

$ fonte /etc/bash_completion

$ source <(bash de conclus√£o do minikube)

Se necess√°rio, execute tamb√©m o seguinte comando:

$ minikube completion bash

Um comando que permite aos usu√°rios listar os n√≥s de um cluster, adicionar novos n√≥s de plano de controle ou n√≥s de trabalho, excluir n√≥s de cluster existentes, iniciar ou parar n√≥s individuais de um cluster:

$ lista de n√≥s do minikube

minikube  192.168.59.100

$ minikube lista de n√≥s -p minibox

minibox 192.168.59.101
minibox-m02 192.168.59.102
minibox-m03 192.168.59.103

Para exibir o endere√ßo IP do n√≥ do plano de controle do cluster ou o IP de outro n√≥ com os sinalizadores --node  ou -n :

$ minikube ip

192.168.59.100

$ minikube -p ip do minibox

192.168.59.101

$ minikube -p minibox ip -n minibox-m02

192.168.59.102

Quando uma configura√ß√£o de cluster n√£o √© mais √∫til, o perfil do cluster pode ser exclu√≠do. Este comando tamb√©m reconhece perfis ‚Äî ele exclui o cluster minikube padr√£o se nenhum perfil for especificado, ou um cluster personalizado se o perfil dele for especificado:

$ minikube delete

üî• Excluindo "minikube" no VirtualBox ...
üíÄ Removido todos os vest√≠gios do cluster "minikube".

$ minikube delete -p minibox

üî• Excluindo "minibox" no VirtualBox ...
üî• Excluindo "minibox-m02" no VirtualBox ...
üî• Excluindo "minibox-m03" no VirtualBox ...
üíÄ Removidos todos os vest√≠gios do cluster "minibox".

Para comandos adicionais e op√ß√µes de uso, visite a refer√™ncia de linha de comando do Minikube . 